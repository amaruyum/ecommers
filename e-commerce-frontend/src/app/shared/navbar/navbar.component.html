<nav class="navbar">
  <div class="nav-inner">

    <!-- Logo -->
    <a routerLink="/dashboard" class="nav-logo">
      <div class="logo-icon">W</div>
      <span>Wellness</span>
    </a>

    <!-- Links -->
    <ul class="nav-links">
      @for (link of navLinks; track link.path) {
        <li>
          <a [routerLink]="link.path"
             routerLinkActive="active"
             [routerLinkActiveOptions]="{ exact: link.path === '/dashboard' }">
            {{ link.label }}
          </a>
        </li>
      }
    </ul>

    <!-- Acciones -->
    <div class="nav-actions">

      <!-- Buscar -->
      <button class="icon-btn search-btn" (click)="openSearch()" title="Buscar">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
      </button>

      <!-- Notificaciones -->
      <button class="icon-btn badge-btn" title="Notificaciones">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
        </svg>
        <span class="badge">2</span>
      </button>

      <!-- Carrito -->
      <button class="icon-btn badge-btn cart-btn" (click)="cart.abrirDrawer()" title="Carrito"
              [class.has-items]="!cart.estaVacio()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        @if (!cart.estaVacio()) {
          <span class="badge badge-orange">{{ cart.totalItems() }}</span>
        }
      </button>

      <!-- Usuario -->
      <div class="user-menu">
        <button class="avatar-btn" (click)="toggleDropdown()" [class.open]="dropdownOpen()">
          <div class="avatar">{{ getInitials() }}</div>
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2.5"
               [style.transform]="dropdownOpen() ? 'rotate(180deg)' : 'rotate(0)'"
               style="transition: transform 0.2s">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </button>

        @if (dropdownOpen()) {
          <div class="dropdown">
            <div class="dropdown-header">
              <strong>{{ usuario?.nombre_completo }}</strong>
              <span>{{ usuario?.correo_electronico }}</span>
            </div>
            <hr/>
            <a routerLink="/dashboard/perfil" class="dropdown-item" (click)="dropdownOpen.set(false)">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
              Mi Perfil
            </a>
            <hr/>
            @if (isAdmin) {
              <a routerLink="/admin" class="dropdown-item admin-link" (click)="dropdownOpen.set(false)">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                Panel Admin
              </a>
              <hr/>
            }
            <button class="dropdown-item logout" (click)="logout()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
              Cerrar SesiÃ³n
            </button>
          </div>
        }
      </div>

    </div>
  </div>
</nav>

<!-- Cart Drawer -->
<app-cart-drawer />

<!-- â”€â”€ SEARCH OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
@if (searchOpen()) {
  <div class="search-overlay" (click)="closeSearch()">
    <div class="search-modal" (click)="$event.stopPropagation()">

      <!-- Input -->
      <div class="search-input-wrap">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
             fill="none" stroke="#8A8A8A" stroke-width="2">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
        <input
          id="global-search-input"
          type="text"
          placeholder="Buscar retiros, productos, artÃ­culos..."
          [value]="searchQuery()"
          (input)="onSearchInput($any($event.target).value)"
          autocomplete="off"/>
        @if (searchQuery()) {
          <button class="clear-btn" (click)="onSearchInput('')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        }
        <kbd class="esc-key" (click)="closeSearch()">ESC</kbd>
      </div>

      <!-- Loading -->
      @if (searchLoading()) {
        <div class="search-loading">
          <span class="spinner"></span>
          <span>Buscando...</span>
        </div>
      }

      <!-- Sin query -->
      @if (!searchQuery() && !searchLoading()) {
        <div class="search-hint">
          <div class="hint-cats">
            <button class="hint-cat" (click)="onSearchInput('retiro')">ðŸŒ¿ Retiros</button>
            <button class="hint-cat" (click)="onSearchInput('yoga')">ðŸ§˜ Yoga</button>
            <button class="hint-cat" (click)="onSearchInput('meditaciÃ³n')">âœ¨ MeditaciÃ³n</button>
            <button class="hint-cat" (click)="onSearchInput('taller')">ðŸ“š Talleres</button>
            <button class="hint-cat" (click)="onSearchInput('nutriciÃ³n')">ðŸ¥— NutriciÃ³n</button>
          </div>
          <p class="hint-tip">Escribe al menos 2 caracteres para buscar</p>
        </div>
      }

      <!-- Resultados -->
      @if (resultados().length > 0 && !searchLoading()) {
        <div class="search-results">
          <div class="results-header">
            <span>{{ resultados().length }} resultado{{ resultados().length !== 1 ? 's' : '' }}</span>
          </div>
          <ul class="results-list">
            @for (r of resultados(); track r.id + r.tipo) {
              <li class="result-item" (click)="goToResult(r.path)">
                <div class="result-icon" [class]="'icon-' + r.tipo">
                  @if (r.tipo === 'item') {
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                  } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                  }
                </div>
                <div class="result-body">
                  <span class="result-titulo">{{ r.titulo }}</span>
                  <span class="result-sub">{{ r.subtitulo }}</span>
                </div>
                <span class="result-badge" [class]="r.badgeClass">{{ r.badge }}</span>
                <svg class="result-arrow" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              </li>
            }
          </ul>
        </div>
      }

      <!-- Sin resultados -->
      @if (sinResultados() && !searchLoading() && searchQuery().length >= 2) {
        <div class="no-results">
          <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#C8BFB0" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
          <p>No se encontraron resultados para <strong>"{{ searchQuery() }}"</strong></p>
          <span>Prueba con otras palabras</span>
        </div>
      }

    </div>
  </div>
}